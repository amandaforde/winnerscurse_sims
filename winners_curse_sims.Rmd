---
title: "Evaluating Winner's Curse methods"
author: ""
date: ""
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(parallel)
library(ggplot2)
library(RColorBrewer)
library(kableExtra)
col <- brewer.pal(8,"Dark2")
```

In this document, we intend to investigate the following key questions, assuming a fixed array of $10^6$ SNPs: 

- When should I be concerned about Winner's Curse or about my association estimates being more extreme than their corresponding true effect sizes?
- If I adjust SNP-trait association estimates using a Winner's Curse method, how much should I expect this to improve the association estimates of significant SNPs? 
- If I do use a Winner's Curse method, which one should I use? 

We first focus on a quantitative trait in which SNP effect sizes follow a ***normal*** distribution.


### 1. When is Winner's Curse a problem? 

In this section, we look at the average number of significant SNPs, the average proportion of these significant SNPs that have association estimates more extreme than their true effect size and the average MSE of significant SNPs at two different thresholds; the common genome-wide significance threshold of $5 \times 10^{-8}$ and a higher threshold of $5 \times 10^{-4}$. We consider these properties under certain combinations of values for the following parameters:

1. sample size - `n_samples`
2. heritability - `h2`
3. polygenicity, i.e. proportion of effect SNPs - `prop_effect`
4. selection coefficient - `S`

The 24 different combinations that we will investigate throughout this document are detailed below:

```{r, echo=FALSE}
params_1 <- data.frame(Scenario=c(1:12),n_samples = c(rep(c("30,000","300,000"),6)), h2 = c(rep(c(0.3,0.3,0.8,0.8),3)), prop_effect=c(0.01,0.01,0.01,0.01,0.001,0.001,0.001,0.001,0.01,0.01,0.01,0.01), S=c(rep(-1,8),rep(0,4)))
params_2 <- data.frame(Scenario=c(13:24),n_samples = c(rep(c("30,000","300,000"),6)), h2 = c(rep(c(0.3,0.3,0.8,0.8),3)), prop_effect=c(0.001,0.001,0.001,0.001,0.01,0.01,0.01,0.01,0.001,0.001,0.001,0.001), S=c(rep(0,4),rep(1,8)))

params_1 %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE, position="float_left") %>%
  row_spec(row = 0,bold = TRUE)  

params_2 %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="left") %>%
  row_spec(row = 0,bold = TRUE)



```

$~$
$~$
$~$


Running the code provided in `nsig_prop_bias_100sim.R`, we obtain the following results. Note that `prop_x` refers to the proportion of significant SNPs which have been found to be significantly overestimated, i.e. those SNPs in which $\left| \hat\beta_{i} \right| > \left| \beta_{i} \right| + 1.96\cdot\sigma_{i}$.

```{r, echo=FALSE}

results_nsig_5e_8 <- read.csv("results/norm_nsig_prop_bias_5e-8.csv")
results_nsig_5e_4 <- read.csv("results/norm_nsig_prop_bias_5e-4.csv")
results_nsig <- data.frame(Scenario=c(1:24),n_samples=c(rep(c("30,000","300,000"),12)),results_nsig_5e_8[3:5], nsig_5e_8=round(results_nsig_5e_8$n_sig,2), pb58 = round(results_nsig_5e_8$prop_bias,4), px58 = round(results_nsig_5e_8$prop_x,4), mse58 = round(results_nsig_5e_8$mse,6), nsig_5e_4=round(results_nsig_5e_4$n_sig,2), pb54 = round(results_nsig_5e_4$prop_bias,4), px54 = round(results_nsig_5e_4$prop_x,4), mse54 = round(results_nsig_5e_4$mse,6), nsig_5e_8_sd=round(results_nsig_5e_8$n_sig_sd,3), pb58sd=round(results_nsig_5e_8$prop_bias_sd,4), px58sd=round(results_nsig_5e_8$prop_x_sd,4), mse58sd=round(results_nsig_5e_8$mse_sd,6),  nsig_5e_4_sd=round(results_nsig_5e_4$n_sig_sd,3),  pb54sd=round(results_nsig_5e_4$prop_bias_sd,4), px54sd=round(results_nsig_5e_4$prop_x_sd,4), mse54sd=round(results_nsig_5e_4$mse_sd,6))

names(results_nsig)[names(results_nsig) == "nsig_5e_8"] <- "n_sig 5e-8"
names(results_nsig)[names(results_nsig) == "nsig_5e_8_sd"] <- "sd(n_sig) 5e-8"
names(results_nsig)[names(results_nsig) == "pb58"] <- "prop_bias 5e-8"
names(results_nsig)[names(results_nsig) == "pb58sd"] <- "sd(prop_bias) 5e-8"
names(results_nsig)[names(results_nsig) == "px58"] <- "prop_x 5e-8"
names(results_nsig)[names(results_nsig) == "px58sd"] <- "sd(prop_x) 5e-8"
names(results_nsig)[names(results_nsig) == "nsig_5e_4"] <- "n_sig 5e-4"
names(results_nsig)[names(results_nsig) == "nsig_5e_4_sd"] <- "sd(n_sig) 5e-4"
names(results_nsig)[names(results_nsig) == "pb54"] <- "prop_bias 5e-4"
names(results_nsig)[names(results_nsig) == "pb54sd"] <- "sd(prop_bias) 5e-4"
names(results_nsig)[names(results_nsig) == "px54"] <- "prop_x 5e-4"
names(results_nsig)[names(results_nsig) == "px54sd"] <- "sd(prop_x) 5e-4"
names(results_nsig)[names(results_nsig) == "mse58"] <- "mse 5e-8"
names(results_nsig)[names(results_nsig) == "mse58sd"] <- "sd(mse) 5e-8"
names(results_nsig)[names(results_nsig) == "mse54"] <- "mse 5e-4"
names(results_nsig)[names(results_nsig) == "mse54sd"] <- "sd(mse) 5e-4"

results_nsig %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#FAE5D3") %>%
  column_spec(2,background="#FDF2E9") %>%
  column_spec(3,background="#FDF2E9") %>%
  column_spec(4,background="#FDF2E9") %>%
  column_spec(5,background="#FDF2E9", extra_css="border-right: 1px solid") %>% 
  column_spec(9, extra_css="border-right: 1px solid") %>%
  column_spec(13, extra_css="border-right: 1px solid") %>%
   column_spec(14, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(15, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(17, background = "#F5F5F5", italic=TRUE, extra_css="border-right: 1px solid") %>%
  column_spec(18, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(16, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(19, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(20, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(21, background = "#F5F5F5", italic=TRUE) %>%
  scroll_box(width = "100%", height = "300px")

```

$~$
$~$
$~$

<span class="star">&#x2605;</span>   It is important to note here that for scenarios 1, 9 and 17, very few significant SNPs are detected on average. In some instances, we may even find that no SNPs are deemed significant at a threshold of $5 \times 10^{-8}$. We must keep this observation in mind going forward as we investigate the performance of methods under these three scenarios.   

For both thresholds, the average number of significant SNPs increases as sample size increases, as expected. It also increases with heritability. However, the effect of changing `prop_effect` is more interesting. Decreasing the proportion of effect SNPs from 0.01 to 0.001 results in the number of significant SNPs increasing for a sample size of 30,000 while we witness the number of SNPs passing the genome-wide significance threshold decreasing for a larger sample size of 300,000. 

Furthermore, increasing sample size and increasing heritability from 0.3 to 0.8 all tend to decrease the fraction of significant SNPs whose estimates are more extreme than their true effect size. Decreasing polygenicity from 0.01 to 0.001 also has this same effect at a significance threshold of $5 \times 10^{-8}$.

As sample size increases from 30,000 to 300,000 in all scenarios, `prop_x`, the proportion of significant SNPs which have been found to be significantly overestimated, decreases. This is a strong indicator that as the value of `n_samples` increases, we expect the bias induced by Winner's Curse to be less of a problem among significant SNPs. However, this could also be due to the fact that as sample size increases, the number of significant SNPs passing the genome-wide significance threshold of `5e-8` also increases. 

In order to gain a better insight into the information detailed in the above table, we simulate a single set of GWAS summary statistics and plot $z$ vs $\text{bias}$  in which $\text{bias} = \hat\beta - \beta$ for each of the 24 different scenarios. On all figures, the <span style="color: red;"> bright red </span>
line corresponds to the significance threshold of $5 \times 10^{-8}$ while the <span style="color: darkred;"> darker red </span> line relates to $5 \times 10^{-4}$. The points corresponding to SNPs which are *significantly* overestimated and are significant at a threshold of $5 \times 10^{-4}$ are coloured in <span style="color: navy;"> navy </span>.

$~$
$~$
$~$
$~$

```{r, echo=FALSE}
# required functions!
n_snps <- 10^6

simulate_ss <- function(H,Pi,nid,sc){
  effect_snps <- Pi*n_snps
  maf <- runif(n_snps,0.01,0.5)
  true_beta <- rnorm(effect_snps,0,sd=sqrt((2*maf*(1-maf))^sc)) 
  var_y <- sum(2*maf[1:effect_snps]*(1-maf[1:effect_snps])*true_beta^2)/H
  true_beta <- true_beta/sqrt(var_y) 
  true_beta <- c(true_beta, rep(0,n_snps-effect_snps))
  se <- sqrt((1 - 2*maf*(1-maf)*true_beta^2)/(2*(nid-2)*maf*(1-maf)))
  stats <- data.frame(true_beta,se,maf)
  return(stats)
}

simulate_est <- function(stats){
  est <- data.frame(rsid=seq(1,n_snps),beta=rnorm(n=n_snps,mean=stats$true_beta,sd=stats$se),se=stats$se)
  return(est)
}

simulate_ss_bim <- function(H,Pi,nid,sc){
  effect_snps <- Pi*n_snps
  maf <- runif(n_snps,0.01,0.5)
  true_beta <- c(rnorm(0.5*effect_snps,2.5,sd=sqrt((2*maf*(1-maf))^sc)),rnorm(0.5*effect_snps,0,sd=sqrt((2*maf[(0.5*effect_snps+1):effect_snps]*(1-maf[(0.5*effect_snps+1):effect_snps]))^sc)))
  var_y <- sum(2*maf[1:effect_snps]*(1-maf[1:effect_snps])*true_beta^2)/H
  true_beta <- true_beta/sqrt(var_y)
  true_beta <- c(true_beta, rep(0,n_snps-effect_snps))
  se <- sqrt((1 - 2*maf*(1-maf)*true_beta^2)/(2*(nid-2)*maf*(1-maf)))
  stats <- data.frame(true_beta,se)
  return(stats)
}


###  convert logit values to probabilities
expit <- function(x){exp(x)/(1+exp(x))}
## find Gamma0 for logistic model so prevalence is 0.1
myfunc <- function(MAF,Gamma0, Gamma1, prev=0.1){
  MAF^2*expit(Gamma0+Gamma1*2)+2*MAF*(1-MAF)*expit(Gamma0+Gamma1)+(1-MAF)^2*expit(Gamma0)-prev
}
## calculate asymptotic version of (X^t W X) 
asymp_var_logistic <- function(n,G_prob,Gamma_0,Gamma_1){
  N <- length(Gamma_0)
  disease_probs <- expit(outer(Gamma_0,c(1,1,1)) +  outer(Gamma_1,c(0,1,2)))
  diag_weights <- disease_probs*(1-disease_probs)
  a <- n*apply(G_prob*diag_weights,1,sum)
  b <- n*apply(G_prob*diag_weights*matrix(rep(c(0,1,2),N),byrow=TRUE,nrow=N),1,sum)
  c <-  b 
  d <- n*apply(G_prob*diag_weights*matrix(rep(c(0,1,4),N),byrow=TRUE,nrow=N),1,sum)                     
  ##  invert matrix and take element for Gamma1
  return(a/(a*d-b*c))
}

params <- expand.grid(
  maf = seq(0.01,0.5,by=0.01),
  true_beta = seq(-1.5,1.5,by=0.01)
)

params$maf <- round(params$maf,2)
params$true_beta <- round(params$true_beta,2)
params$Gamma_0 <- c(rep(0,nrow(params)))
for(i in 1:nrow(params)){
  params$Gamma_0[i] <- uniroot(myfunc,Gamma1=params$true_beta[i],MAF=params$maf[i],prev=0.1,lower=-10, upper=10)$root
  }


simulate_ss_bin <- function(H,Pi,nid,sc){
  effect_snps <- Pi*n_snps
  maf <- runif(n_snps,0.01,0.5)
  true_beta <- rnorm(effect_snps,0,sd=sqrt((2*maf*(1-maf))^sc))
  scaling <- (1.6^2*H^2)/((sum(2*maf[1:effect_snps]*(1-maf[1:effect_snps])*true_beta^2))*(1-H^2))
  true_beta <- true_beta*sqrt(scaling)
  true_beta <- c(true_beta, rep(0,n_snps-effect_snps))
  
  rounded_maf <- round(maf,2)
  rounded_true_beta <- round(true_beta,2)
  Gamma0 <- c(rep(0,n_snps))
  dat <- data.frame(rounded_maf, rounded_true_beta)
  for(i in 1:n_snps) Gamma0[i] <- params$Gamma_0[7500 + 5000*rounded_true_beta[i] + 100*rounded_maf[i]]
  
  ##  assuming HWE
  G_prob <- cbind(maf^2,2*maf*(1-maf),(1-maf)^2)
  Gamma1 <- true_beta  
  var_Gamma_y <- asymp_var_logistic(nid,G_prob,Gamma0,Gamma1)
  se <- sqrt(var_Gamma_y)
  stats <- data.frame(true_beta,se)
  return(stats)
}
```



```{r, warning=FALSE,echo=FALSE, fig.show="hold", out.width="50%"}
set.seed(1998)

par(mar = c(4, 4, .1, .1))


## Scenario 1
ss <- simulate_ss(H=0.3,Pi=0.01,nid=30000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + xlim(-6, 6) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 1", subtitle="n_samples=30,000   h2=0.3   prop_effect=0.01   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[1]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )




## Scenario 2
ss <- simulate_ss(H=0.3,Pi=0.01,nid=300000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, aes(x=z,y=bias), color='navy',size=1) +  xlab("z") +
  ylab("bias") + ggtitle("Scenario 2", subtitle="n_samples=300,000   h2=0.3   prop_effect=0.01   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[2]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )




## Scenario 3
ss <- simulate_ss(H=0.8,Pi=0.01,nid=30000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 3", subtitle="n_samples=30,000   h2=0.8   prop_effect=0.01   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[3]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )




## Scenario 4
ss <- simulate_ss(H=0.8,Pi=0.01,nid=300000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 4", subtitle="n_samples=300,000   h2=0.8   prop_effect=0.01   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[4]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 5
ss <- simulate_ss(H=0.3,Pi=0.001,nid=30000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 5", subtitle="n_samples=30,000   h2=0.3   prop_effect=0.001   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[5]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 6
ss <- simulate_ss(H=0.3,Pi=0.001,nid=300000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 6", subtitle="n_samples=300,000   h2=0.3   prop_effect=0.001   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[6]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 7
ss <- simulate_ss(H=0.8,Pi=0.001,nid=30000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 7", subtitle="n_samples=30,000   h2=0.8   prop_effect=0.001   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[7]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 8
ss <- simulate_ss(H=0.8,Pi=0.001,nid=300000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 8", subtitle="n_samples=300,000   h2=0.8   prop_effect=0.001   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[8]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 9
ss <- simulate_ss(H=0.3,Pi=0.01,nid=30000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + xlim(-6, 6) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 9", subtitle="n_samples=30,000   h2=0.3   prop_effect=0.01   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[1]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 10
ss <- simulate_ss(H=0.3,Pi=0.01,nid=300000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 10", subtitle="n_samples=300,000   h2=0.3   prop_effect=0.01   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[2]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 11
ss <- simulate_ss(H=0.8,Pi=0.01,nid=30000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 11", subtitle="n_samples=30,000   h2=0.8   prop_effect=0.01   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[3]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 12
ss <- simulate_ss(H=0.8,Pi=0.01,nid=300000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 12", subtitle="n_samples=300,000   h2=0.8   prop_effect=0.01   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[4]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 13
ss <- simulate_ss(H=0.3,Pi=0.001,nid=30000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 13", subtitle="n_samples=30,000   h2=0.3   prop_effect=0.001   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[5]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 14
ss <- simulate_ss(H=0.3,Pi=0.001,nid=300000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 14", subtitle="n_samples=300,000   h2=0.3   prop_effect=0.001   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[6]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 15
ss <- simulate_ss(H=0.8,Pi=0.001,nid=30000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 15", subtitle="n_samples=30,000   h2=0.8   prop_effect=0.001   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[7]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 16
ss <- simulate_ss(H=0.8,Pi=0.001,nid=300000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 16", subtitle="n_samples=300,000   h2=0.8   prop_effect=0.001   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[8]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 17
ss <- simulate_ss(H=0.3,Pi=0.01,nid=30000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + xlim(-6, 6) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 17", subtitle="n_samples=30,000   h2=0.3   prop_effect=0.01   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[1]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 18
ss <- simulate_ss(H=0.3,Pi=0.01,nid=300000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 18", subtitle="n_samples=300,000   h2=0.3   prop_effect=0.01   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[2]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 19
ss <- simulate_ss(H=0.8,Pi=0.01,nid=30000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 19", subtitle="n_samples=30,000   h2=0.8   prop_effect=0.01   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[3]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 20
ss <- simulate_ss(H=0.8,Pi=0.01,nid=300000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 20", subtitle="n_samples=300,000   h2=0.8   prop_effect=0.01   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[4]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 21
ss <- simulate_ss(H=0.3,Pi=0.001,nid=30000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1)  + xlab("z") +
  ylab("bias") + ggtitle("Scenario 21", subtitle="n_samples=30,000   h2=0.3   prop_effect=0.001   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[5]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 22
ss <- simulate_ss(H=0.3,Pi=0.001,nid=300000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 22", subtitle="n_samples=300,000   h2=0.3   prop_effect=0.001   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[6]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 23
ss <- simulate_ss(H=0.8,Pi=0.001,nid=30000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 23", subtitle="n_samples=30,000   h2=0.8   prop_effect=0.001   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[7]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 24
ss <- simulate_ss(H=0.8,Pi=0.001,nid=300000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 24", subtitle="n_samples=300,000   h2=0.8   prop_effect=0.001   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[8]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )
```



### 2. Evaluating methods using a significance threshold of $5 \times 10^{-8}$

Using the code detailed in `norm_5e-8_20sim.R` and a total of 20 simulations, we evaluated six different Winner's Curse methods across each of the 24 scenarios using the following three bias evaluation metrics: 

1. The average fraction of significant SNPs in which their association estimates have been improved due to method implementation - `flb`
2. The average change in average MSE of significant SNPs due to method implementation - `mse`
3. The average *relative* change in average MSE of significant SNPs due to method implementation - `rel_mse`

**Note:** All averages are obtained over only those simulations in which at least one significant SNP was detected. 


Firstly, the fraction of $n$ significant SNPs in which their association estimates have been improved due to method implementation may be mathematically described as: $$\frac{1}{n} \; \sum_{i=1}^{n}\mathbb{I} \left\{ \left| \hat\beta_i - \beta_i \right|  >  \left|\hat\beta_{\text{adj,}i} - \beta_i\right| \right\},$$in which $\left| \frac{\hat\beta_i}{\hat\sigma_i} \right| > Z_{\frac{\alpha}{2}}$ for all $i = 1,...,n$, where $\hat\beta_i$ is the estimated naive effect size of SNP $i$, $\beta_i$ is its true effect size and $\hat\beta_{\text{adj,}i}$ is its new effect size estimate obtained as a result of application of the Winner's Curse adjustment method of interest. The significance threshold is represented by $\alpha$.

Using the same notation, the average MSE over $n$ significant SNPs is defined as: $$\frac{1}{n} \sum^n_{i=1} (\hat\beta_i - \beta_i)^2.$$ Thus, using the above, we may formally define the change in average MSE of significant SNPs as: $$\frac{1}{n} \sum^n_{i=1} (\hat\beta_{\text{adj,}i} - \beta_i)^2 - \frac{1}{n} \sum^n_{i=1} (\hat\beta_i - \beta_i)^2$$ and the relative change in average MSE of significant SNPs as: $$\frac{\frac{1}{n} \sum^n_{i=1} (\hat\beta_{\text{adj,}i} - \beta_i)^2 - \frac{1}{n} \sum^n_{i=1} (\hat\beta_i - \beta_i)^2}{\frac{1}{n} \sum^n_{i=1} (\hat\beta_i - \beta_i)^2}.$$ 

$~$

Results of the simulations are plotted. Error bars are also included in the plots. These figures allow us to see more clearly the scenarios in which it would be beneficial to apply a Winner's Curse correction method and also, provide us with a better indication of which method we should use.

A replication method which selects significant SNPs from a discovery GWAS and then uses a replication GWAS of the *same size* to obtain association estimates for these SNPs is also included in the plots. This can be viewed as acting as a form of benchmark for the other methods. 

Summary of results for `flb` contained in `norm_5e-8_20sim.csv`:

```{r,echo=FALSE}

norm_5e_8_20sim <- read.csv("results/norm_5e-8_20sim.csv")
results_flb <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = norm_5e_8_20sim$h2[1:24], prop_effect = norm_5e_8_20sim$prop_effect[1:24], S= norm_5e_8_20sim$S[1:24], EB = round(norm_5e_8_20sim$flb[1:24],4), FIQT = round(norm_5e_8_20sim$flb[(1+24):(24+24)],4), BR = round(norm_5e_8_20sim$flb[(1+2*24):(24+2*24)],4), cl1 = round(norm_5e_8_20sim$flb[(1+3*24):(24+3*24)],4), cl2 = round(norm_5e_8_20sim$flb[(1+4*24):(24+4*24)],4), cl3 = round(norm_5e_8_20sim$flb[(1+5*24):(24+5*24)],4), rep = round(norm_5e_8_20sim$flb[(1+6*24):(24+6*24)],4))


results_flb %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D4E6F1") %>%
  column_spec(2,background="#EAF2F8") %>%
  column_spec(3,background="#EAF2F8") %>%
  column_spec(4,background="#EAF2F8") %>%
  column_spec(5,background="#EAF2F8",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "78%", height = "300px")

```
$~$
$~$
$~$
$~$

**Fraction of significant SNPs with improved association estimates due to method implementation, using a significance threshold of $5 \times 10^{-8}$:**

```{r,echo=FALSE, fig.show="hold", out.width="50%",fig.height=3.6}

## plot results
norm_5e_8_20sim$scenario <- c(rep(c(1:24),7))
norm_5e_8_20sim$scenario <- factor(norm_5e_8_20sim$scenario)

par(mar = c(4, 4, .1, .1))


data_negS <- norm_5e_8_20sim[which(norm_5e_8_20sim$S==-1),]
data_negSa <- data_negS[data_negS$scenario == 1 | data_negS$scenario == 2 |data_negS$scenario == 3 |data_negS$scenario == 4,]
ggplot(data_negSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_negSb <- data_negS[data_negS$scenario == 5 | data_negS$scenario == 6 |data_negS$scenario == 7 |data_negS$scenario == 8,]
ggplot(data_negSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralS <- norm_5e_8_20sim[which(norm_5e_8_20sim$S==0),]
data_neutralSa <- data_neutralS[data_neutralS$scenario == 9 | data_neutralS$scenario == 10 |data_neutralS$scenario == 11 |data_neutralS$scenario == 12,]
ggplot(data_neutralSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralSb <- data_neutralS[data_neutralS$scenario == 13 | data_neutralS$scenario == 14 |data_neutralS$scenario == 15 |data_neutralS$scenario == 16,]
ggplot(data_neutralSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

data_posS <- norm_5e_8_20sim[which(norm_5e_8_20sim$S==1),]
data_posSa <- data_posS[data_posS$scenario == 17 | data_posS$scenario == 18 |data_posS$scenario == 19 |data_posS$scenario == 20,]
ggplot(data_posSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_posSb <- data_posS[data_posS$scenario == 21 | data_posS$scenario == 22 |data_posS$scenario == 23 |data_posS$scenario == 24,]
ggplot(data_posSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```
$~$
$~$
$~$
$~$

Summary of results for `mse` contained in `norm_5e-8_20sim.csv`:

```{r,echo=FALSE}

results_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = norm_5e_8_20sim$h2[1:24], prop_effect = norm_5e_8_20sim$prop_effect[1:24], S= norm_5e_8_20sim$S[1:24], EB = round(norm_5e_8_20sim$mse[1:24],6), FIQT = round(norm_5e_8_20sim$mse[(1+24):(24+24)],6), BR = round(norm_5e_8_20sim$mse[(1+2*24):(24+2*24)],6), cl1 = round(norm_5e_8_20sim$mse[(1+3*24):(24+3*24)],6), cl2 = round(norm_5e_8_20sim$mse[(1+4*24):(24+4*24)],6), cl3 = round(norm_5e_8_20sim$mse[(1+5*24):(24+5*24)],6), rep = round(norm_5e_8_20sim$mse[(1+6*24):(24+6*24)],6))

results_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#FCF3CF") %>%
  column_spec(2,background="#FEF9E7") %>%
  column_spec(3,background="#FEF9E7") %>%
  column_spec(4,background="#FEF9E7") %>%
  column_spec(5,background="#FEF9E7",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "87%", height = "300px")
```

$~$
$~$
$~$
$~$


***Change*** **in average MSE over all significant SNPs due to method implementation, using a significance threshold of $5 \times 10^{-8}$:**

```{r,echo=FALSE, fig.show="hold", out.width="50%",fig.height=3.6}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_negSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```

$~$
$~$
$~$
$~$



Summary of results for `rel_mse` contained in `norm_5e-8_20sim.csv`:

```{r,echo=FALSE}

results_rel_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = norm_5e_8_20sim$h2[1:24], prop_effect = norm_5e_8_20sim$prop_effect[1:24], S= norm_5e_8_20sim$S[1:24], EB = round(norm_5e_8_20sim$rel_mse[1:24],4), FIQT = round(norm_5e_8_20sim$rel_mse[(1+24):(24+24)],4), BR = round(norm_5e_8_20sim$rel_mse[(1+2*24):(24+2*24)],4), cl1 = round(norm_5e_8_20sim$rel_mse[(1+3*24):(24+3*24)],4), cl2 = round(norm_5e_8_20sim$rel_mse[(1+4*24):(24+4*24)],4), cl3 = round(norm_5e_8_20sim$rel_mse[(1+5*24):(24+5*24)],4), rep = round(norm_5e_8_20sim$rel_mse[(1+6*24):(24+6*24)],4))

results_rel_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D4EFDF") %>%
  column_spec(2,background="#E9F7EF") %>%
  column_spec(3,background="#E9F7EF") %>%
  column_spec(4,background="#E9F7EF") %>%
  column_spec(5,background="#E9F7EF",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "80%", height = "300px")
```



$~$
$~$
$~$
$~$


The *mean* relative change in average MSE over all significant SNPs across the 24 scenarios is obtained for each method: 
```{r, echo=FALSE}
ranking <- results_rel_mse[,6:12]
summary2 <- apply(ranking,2,mean,na.rm=TRUE)
summary2
```


The methods are ranked according to the results above in ascending order:
```{r, echo=FALSE}
rank(summary2)
```



$~$
$~$
$~$
$~$



***Relative change*** **in average MSE over all significant SNPs due to method implementation, using a significance threshold of $5 \times 10^{-8}$:**

```{r,echo=FALSE, fig.show="hold", out.width="50%",fig.height=3.6, warning=FALSE}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_negSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 
```

$~$
$~$
$~$
$~$

### 3. Observations and discussion of above simulations

It is worth noting from the above simulations how the Winner's Curse methods tend to break down, or equivalently, no longer make improvements based on the third evaluation metric, `rel_mse` when the proportion of effect SNPs is 0.001. This is a measure of polygenicity. That said, the empirical Bayes method performs extremely similar to just taking a replication estimate when the replication sample is of the same size as the discovery GWAS, i.e. `n_samples` is equivalent in both data sets and as we will see later, the empirical Bayes will outperform the replication method when the replication GWAS sample size becomes smaller than that of the discovery, at this threshold of `5e-8`. This observation *strongly supports the use of empirical Bayes* as a Winner's Curse adjustment method, particularly when a replication GWAS is not available. 

For `prop_effect = 0.01`, our proposed bootstrap method for summary statistics performs in a comparable manner to both empirical Bayes and the replication method. However, the bootstrap method ceases to perform as well at obtaining less biased association estimates when the proportion of effect SNPs is reduced to 0.001. 

On all occasions, the conditional likelihood methods tend to perform poorly compared to the other methods.

Clearly, even though we also look at using a significance threshold of $5 \times 10^{-4}$, it is the genome-wide significance threshold of $5 \times 10^{-8}$ that is of most interest to us as using the higher threshold of $5 \times 10^{-4}$ often results in the detection of many false positives.  



### 4. Evaluating methods using a significance threshold of $5 \times 10^{-4}$

Similar to part 2 above, we use the code detailed in `norm_5e-4_10sim.R` with a total of 10 simulations in order to evaluate seven different Winner's Curse methods across each of the 24 scenarios. In the following investigations, we will concentrate on the final bias evaluation metric, `rel_mse`.


```{r,echo=FALSE,include=FALSE}

norm_5e_4_10sim <- read.csv("results/norm_5e-4_10sim.csv")
results_flb <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = norm_5e_4_10sim$h2[1:24], prop_effect = norm_5e_4_10sim$prop_effect[1:24], S= norm_5e_4_10sim$S[1:24], EB = round(norm_5e_4_10sim$flb[1:24],4), FIQT = round(norm_5e_4_10sim$flb[(1+24):(24+24)],4), BR = round(norm_5e_4_10sim$flb[(1+2*24):(24+2*24)],4), cl1 = round(norm_5e_4_10sim$flb[(1+3*24):(24+3*24)],4), cl2 = round(norm_5e_4_10sim$flb[(1+4*24):(24+4*24)],4), cl3 = round(norm_5e_4_10sim$flb[(1+5*24):(24+5*24)],4), rep = round(norm_5e_4_10sim$flb[(1+6*24):(24+6*24)],4))

results_flb %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#F2D7D5") %>%
  column_spec(2,background="#F9EBEA") %>%
  column_spec(3,background="#F9EBEA") %>%
  column_spec(4,background="#F9EBEA") %>%
  column_spec(5,background="#F9EBEA",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "90%", height = "300px")

```

```{r,echo=FALSE, fig.show="hold", include=FALSE,out.width="50%",fig.height=3.6}

## plot results
norm_5e_4_10sim$scenario <- c(rep(c(1:24),7))
norm_5e_4_10sim$scenario <- factor(norm_5e_4_10sim$scenario)

par(mar = c(4, 4, .1, .1))


data_negS <- norm_5e_4_10sim[which(norm_5e_4_10sim$S==-1),]
data_negSa <- data_negS[data_negS$scenario == 1 | data_negS$scenario == 2 |data_negS$scenario == 3 |data_negS$scenario == 4,]
ggplot(data_negSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_negSb <- data_negS[data_negS$scenario == 5 | data_negS$scenario == 6 |data_negS$scenario == 7 |data_negS$scenario == 8,]
ggplot(data_negSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralS <- norm_5e_4_10sim[which(norm_5e_4_10sim$S==0),]
data_neutralSa <- data_neutralS[data_neutralS$scenario == 9 | data_neutralS$scenario == 10 |data_neutralS$scenario == 11 |data_neutralS$scenario == 12,]
ggplot(data_neutralSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralSb <- data_neutralS[data_neutralS$scenario == 13 | data_neutralS$scenario == 14 |data_neutralS$scenario == 15 |data_neutralS$scenario == 16,]
ggplot(data_neutralSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
 ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

data_posS <- norm_5e_4_10sim[which(norm_5e_4_10sim$S==1),]
data_posSa <- data_posS[data_posS$scenario == 17 | data_posS$scenario == 18 |data_posS$scenario == 19 |data_posS$scenario == 20,]
ggplot(data_posSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_posSb <- data_posS[data_posS$scenario == 21 | data_posS$scenario == 22 |data_posS$scenario == 23 |data_posS$scenario == 24,]
ggplot(data_posSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
 ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```

```{r,echo=FALSE,include=FALSE}

results_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = norm_5e_4_10sim$h2[1:24], prop_effect = norm_5e_4_10sim$prop_effect[1:24], S= norm_5e_4_10sim$S[1:24], EB = round(norm_5e_4_10sim$mse[1:24],6), FIQT = round(norm_5e_4_10sim$mse[(1+24):(24+24)],6), BR = round(norm_5e_4_10sim$mse[(1+2*24):(24+2*24)],6), cl1 = round(norm_5e_4_10sim$mse[(1+3*24):(24+3*24)],6), cl2 = round(norm_5e_4_10sim$mse[(1+4*24):(24+4*24)],6), cl3 = round(norm_5e_4_10sim$mse[(1+5*24):(24+5*24)],6), rep = round(norm_5e_4_10sim$mse[(1+6*24):(24+6*24)],6))

results_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#E8DAEF") %>%
  column_spec(2,background="#F4ECF7") %>%
  column_spec(3,background="#F4ECF7") %>%
  column_spec(4,background="#F4ECF7") %>%
  column_spec(5,background="#F4ECF7",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "95%", height = "300px")
```

```{r,echo=FALSE, include=FALSE,fig.show="hold", out.width="50%",fig.height=3.6}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_negSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_neutralSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_posSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```


$~$
$~$
$~$
$~$



Summary of results for `rel_mse` contained in `norm_5e-4_10sim.csv`: 

```{r,echo=FALSE}

results_rel_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = norm_5e_4_10sim$h2[1:24], prop_effect = norm_5e_4_10sim$prop_effect[1:24], S= norm_5e_4_10sim$S[1:24], EB = round(norm_5e_4_10sim$rel_mse[1:24],4), FIQT = round(norm_5e_4_10sim$rel_mse[(1+24):(24+24)],4), BR = round(norm_5e_4_10sim$rel_mse[(1+2*24):(24+2*24)],4), cl1 = round(norm_5e_4_10sim$rel_mse[(1+3*24):(24+3*24)],4), cl2 = round(norm_5e_4_10sim$rel_mse[(1+4*24):(24+4*24)],4), cl3 = round(norm_5e_4_10sim$rel_mse[(1+5*24):(24+5*24)],4), rep = round(norm_5e_4_10sim$rel_mse[(1+6*24):(24+6*24)],4))

results_rel_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D0ECE7") %>%
  column_spec(2,background="#E8F6F3") %>%
  column_spec(3,background="#E8F6F3") %>%
  column_spec(4,background="#E8F6F3") %>%
  column_spec(5,background="#E8F6F3",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "80%", height = "300px")
```
$~$
$~$
$~$
$~$


The *mean* relative change in average MSE over all significant SNPs across the 24 scenarios is obtained for each method: 
```{r, echo=FALSE}
ranking <- results_rel_mse[,6:12]
summary2 <- apply(ranking,2,mean,na.rm=TRUE)
summary2
```


The methods are ranked according to the results above in ascending order:
```{r, echo=FALSE}
rank(summary2)
```



$~$
$~$
$~$
$~$

***Relative change*** **in average MSE over all significant SNPs due to method implementation, using a significance threshold of $5 \times 10^{-4}$:**

```{r,echo=FALSE, fig.show="hold", out.width="50%",fig.height=3.6}



par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_negSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_posSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```


$~$
$~$
$~$
$~$


### 5. Bimodal distribution of effect sizes

Here we investigate the 24 different scenarios under a ***bimodal*** distribution of effect sizes. In order to create a bimodal distribution, we simulate 50% of effect sizes of the true effect SNPs from a normal distribution centered at 0 while the other half are generated from a normal distribution with mean 2.5. As above, we first have a look at the expected number of significant SNPs and the expected proportion of those in which their association estimate is *significantly* exaggerated. 

Running the code provided in `nsig_prop_bias_100sim.R`, we obtain the following results: 

```{r, echo=FALSE}
results_nsig_5e_8 <- read.csv("results/bim_nsig_prop_bias_5e-8.csv")

results_nsig <- data.frame(Scenario=c(1:24),n_samples=c(rep(c("30,000","300,000"),12)),results_nsig_5e_8[3:5], nsig_5e_8=round(results_nsig_5e_8$n_sig,2), pb58 = round(results_nsig_5e_8$prop_bias,4), px58 = round(results_nsig_5e_8$prop_x,4), mse58 = round(results_nsig_5e_8$mse,6), nsig_5e_8_sd=round(results_nsig_5e_8$n_sig_sd,3), pb58sd=round(results_nsig_5e_8$prop_bias_sd,4), px58sd=round(results_nsig_5e_8$prop_x_sd,4), mse58sd=round(results_nsig_5e_8$mse_sd,6))



names(results_nsig)[names(results_nsig) == "nsig_5e_8"] <- "n_sig 5e-8"
names(results_nsig)[names(results_nsig) == "nsig_5e_8_sd"] <- "sd(n_sig) 5e-8"
names(results_nsig)[names(results_nsig) == "pb58"] <- "prop_bias 5e-8"
names(results_nsig)[names(results_nsig) == "pb58sd"] <- "sd(prop_bias) 5e-8"
names(results_nsig)[names(results_nsig) == "px58"] <- "prop_x 5e-8"
names(results_nsig)[names(results_nsig) == "px58sd"] <- "sd(prop_x) 5e-8"
names(results_nsig)[names(results_nsig) == "mse58"] <- "mse 5e-8"
names(results_nsig)[names(results_nsig) == "mse58sd"] <- "sd(mse) 5e-8"



results_nsig %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#FADBD8") %>%
  column_spec(2,background="#FDEDEC") %>%
  column_spec(3,background="#FDEDEC") %>%
  column_spec(4,background="#FDEDEC") %>%
  column_spec(5,background="#FDEDEC",extra_css="border-right: 1px solid") %>%
  column_spec(9,extra_css="border-right: 1px solid") %>%
  column_spec(10, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(11, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(12, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(13, background = "#F5F5F5", italic=TRUE) %>%
  scroll_box(width = "100%", height = "300px")
```

$~$
$~$
$~$
$~$

```{r, warning=FALSE,echo=FALSE, eval=FALSE,fig.show="hold", out.width="50%"}
set.seed(1998)

par(mar = c(4, 4, .1, .1))

## Scenario 11
ss <- simulate_ss_bim(H=0.8,Pi=0.01,nid=30000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 11", subtitle="n_samples=30,000   h2=0.8   prop_effect=0.01   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[3]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 12
ss <- simulate_ss_bim(H=0.8,Pi=0.01,nid=300000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 12", subtitle="n_samples=300,000   h2=0.8   prop_effect=0.01   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[4]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

```


Next, we repeat the process illustrated in Section 2 using the third bias evaluation metric, `rel_mse` with a significance threshold of $5 \times 10^{-8}$.  


```{r,echo=FALSE,include=FALSE}

skew_5e_8_10sim <- read.csv("results/bimod_5e-8_10sim.csv")
results_flb_skew <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = skew_5e_8_10sim$h2[1:24], prop_effect = skew_5e_8_10sim$prop_effect[1:24], S= skew_5e_8_10sim$S[1:24], EB = round(skew_5e_8_10sim$flb[1:24],4), FIQT = round(skew_5e_8_10sim$flb[(1+24):(24+24)],4), BR = round(skew_5e_8_10sim$flb[(1+2*24):(24+2*24)],4), cl1 = round(skew_5e_8_10sim$flb[(1+3*24):(24+3*24)],4), cl2 = round(skew_5e_8_10sim$flb[(1+4*24):(24+4*24)],4), cl3 = round(skew_5e_8_10sim$flb[(1+5*24):(24+5*24)],4), rep = round(skew_5e_8_10sim$flb[(1+6*24):(24+6*24)],4))


results_flb_skew %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D6DBDF") %>%
  column_spec(2,background="#EBEDEF") %>%
  column_spec(3,background="#EBEDEF") %>%
  column_spec(4,background="#EBEDEF") %>%
  column_spec(5,background="#EBEDEF",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "90%", height = "300px")

```

```{r,echo=FALSE, fig.show="hold", include=FALSE,out.width="50%",fig.height=3.6}

## plot results
skew_5e_8_10sim$scenario <- c(rep(c(1:24),7))
skew_5e_8_10sim$scenario <- factor(skew_5e_8_10sim$scenario)

par(mar = c(4, 4, .1, .1))


data_negS <- skew_5e_8_10sim[which(skew_5e_8_10sim$S==-1),]
data_negSa <- data_negS[data_negS$scenario == 1 | data_negS$scenario == 2 |data_negS$scenario == 3 |data_negS$scenario == 4,]
ggplot(data_negSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#1B2631'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_negSb <- data_negS[data_negS$scenario == 5 | data_negS$scenario == 6 |data_negS$scenario == 7 |data_negS$scenario == 8,]
ggplot(data_negSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#1B2631'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralS <- skew_5e_8_10sim[which(skew_5e_8_10sim$S==0),]
data_neutralSa <- data_neutralS[data_neutralS$scenario == 9 | data_neutralS$scenario == 10 |data_neutralS$scenario == 11 |data_neutralS$scenario == 12,]
ggplot(data_neutralSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#1B2631'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralSb <- data_neutralS[data_neutralS$scenario == 13 | data_neutralS$scenario == 14 |data_neutralS$scenario == 15 |data_neutralS$scenario == 16,]
ggplot(data_neutralSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#1B2631'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

data_posS <- skew_5e_8_10sim[which(skew_5e_8_10sim$S==1),]
data_posSa <- data_posS[data_posS$scenario == 17 | data_posS$scenario == 18 |data_posS$scenario == 19 |data_posS$scenario == 20,]
ggplot(data_posSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
 ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#1B2631'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_posSb <- data_posS[data_posS$scenario == 21 | data_posS$scenario == 22 |data_posS$scenario == 23 |data_posS$scenario == 24,]
ggplot(data_posSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#1B2631'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```

```{r,echo=FALSE,include=FALSE}

results_mse_skew <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = skew_5e_8_10sim$h2[1:24], prop_effect = skew_5e_8_10sim$prop_effect[1:24], S= skew_5e_8_10sim$S[1:24], EB = round(skew_5e_8_10sim$mse[1:24],6), FIQT = round(skew_5e_8_10sim$mse[(1+24):(24+24)],6), BR = round(skew_5e_8_10sim$mse[(1+2*24):(24+2*24)],6), cl1 = round(skew_5e_8_10sim$mse[(1+3*24):(24+3*24)],6), cl2 = round(skew_5e_8_10sim$mse[(1+4*24):(24+4*24)],6), cl3 = round(skew_5e_8_10sim$mse[(1+5*24):(24+5*24)],6), rep = round(skew_5e_8_10sim$mse[(1+6*24):(24+6*24)],6))


results_mse_skew %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#EBDEF0") %>%
  column_spec(2,background="#F5EEF8") %>%
  column_spec(3,background="#F5EEF8") %>%
  column_spec(4,background="#F5EEF8") %>%
  column_spec(5,background="#F5EEF8",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "95%", height = "300px")

```

```{r,echo=FALSE, fig.show="hold", include=FALSE, out.width="50%",fig.height=3.6}

## plot results
par(mar = c(4, 4, .1, .1))


ggplot(data_negSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste(italic("Change"), " in average MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#512E5F'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_negSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change"), " in average MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#512E5F'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_neutralSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste(italic("Change"), " in average MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#512E5F'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_neutralSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change"), " in average MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#512E5F'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_posSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change"), " in average MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#512E5F'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_posSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change"), " in average MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#512E5F'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```


Summary of results for `rel_mse` contained in `bimod_5e-8_10sim.csv`:

```{r,echo=FALSE}

results_rel_mse_skew <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = skew_5e_8_10sim$h2[1:24], prop_effect = skew_5e_8_10sim$prop_effect[1:24], S= skew_5e_8_10sim$S[1:24], EB = round(skew_5e_8_10sim$rel_mse[1:24],4), FIQT = round(skew_5e_8_10sim$rel_mse[(1+24):(24+24)],4), BR = round(skew_5e_8_10sim$rel_mse[(1+2*24):(24+2*24)],4), cl1 = round(skew_5e_8_10sim$rel_mse[(1+3*24):(24+3*24)],4), cl2 = round(skew_5e_8_10sim$rel_mse[(1+4*24):(24+4*24)],4), cl3 = round(skew_5e_8_10sim$rel_mse[(1+5*24):(24+5*24)],4), rep = round(skew_5e_8_10sim$rel_mse[(1+6*24):(24+6*24)],4))


results_rel_mse_skew %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#F6DDCC") %>%
  column_spec(2,background="#FBEEE6") %>%
  column_spec(3,background="#FBEEE6") %>%
  column_spec(4,background="#FBEEE6") %>%
  column_spec(5,background="#FBEEE6",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "80%", height = "300px")

```

$~$
$~$
$~$
$~$


The *mean* relative change in average MSE over all significant SNPs across the 24 scenarios is obtained for each method: 
```{r, echo=FALSE}
ranking <- results_rel_mse_skew[,6:12]
summary2 <- apply(ranking,2,mean,na.rm=TRUE)
summary2
```


The methods are ranked according to the results above in ascending order:
```{r, echo=FALSE}
rank(summary2)
```



$~$
$~$
$~$
$~$

***Relative change*** **in average MSE over all significant SNPs due to method implementation, using a significance threshold of $5 \times 10^{-8}$ and a** ***bimodal*** **distribution of effect sizes:**

```{r,echo=FALSE, fig.show="hold", out.width="50%",fig.height=3.6}

## plot results
par(mar = c(4, 4, .1, .1))


ggplot(data_negSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste("Rel.", italic(" change"), " in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#6E2C00'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_negSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change"), " in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#6E2C00'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_neutralSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Rel.", italic(" change"), " in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#6E2C00'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_neutralSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change"), " in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#6E2C00'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_posSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change"), " in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#6E2C00'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_posSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change"), " in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#6E2C00'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```
$~$
$~$
$~$
$~$


### 6. Evaluating methods which use both replication and discovery summary statistics

In this section, we proceed to comparing Winner's Curse adjustment methods which use summary statistics from both the discovery and a replication GWAS. We first consider the situation in which the replication and discovery GWASs are of the *same size*. As an interesting comparison, we have also included the empirical Bayes method here which uses information from just the discovery GWAS. The significance threshold is set to `5e-8` and in this instance, the effect distribution is normal.  

```{r,echo=FALSE,include=FALSE}

rep_norm_5e_8_10sim <- read.csv("results/replicate_norm_5e-8_10sim.csv")
results_flb <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$flb[1:24],4), rep = round(rep_norm_5e_8_10sim$flb[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$flb[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$flb[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$flb[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$flb[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$flb[(1+6*24):(24+6*24)],4), MSE_min_sp = round(rep_norm_5e_8_10sim$flb[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$flb[(1+8*24):(24+8*24)],4))


results_flb %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D4E6F1") %>%
  column_spec(2,background="#EAF2F8") %>%
  column_spec(3,background="#EAF2F8") %>%
  column_spec(4,background="#EAF2F8") %>%
  column_spec(5,background="#EAF2F8",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")

```

```{r,echo=FALSE, fig.show="hold", include=FALSE, out.width="50%",fig.height=3.6}

## plot results
rep_norm_5e_8_10sim$scenario <- c(rep(c(1:24),9))
rep_norm_5e_8_10sim$scenario <- factor(rep_norm_5e_8_10sim$scenario)

par(mar = c(4, 4, .1, .1))


data_negS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==-1),]
data_negSa <- data_negS[data_negS$scenario == 1 | data_negS$scenario == 2 |data_negS$scenario == 3 |data_negS$scenario == 4,]
ggplot(data_negSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'darkred',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_negSb <- data_negS[data_negS$scenario == 5 | data_negS$scenario == 6 |data_negS$scenario == 7 |data_negS$scenario == 8,]
ggplot(data_negSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'darkred',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==0),]
data_neutralSa <- data_neutralS[data_neutralS$scenario == 9 | data_neutralS$scenario == 10 |data_neutralS$scenario == 11 |data_neutralS$scenario == 12,]
ggplot(data_neutralSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'darkred',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralSb <- data_neutralS[data_neutralS$scenario == 13 | data_neutralS$scenario == 14 |data_neutralS$scenario == 15 |data_neutralS$scenario == 16,]
ggplot(data_neutralSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'darkred',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

data_posS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==1),]
data_posSa <- data_posS[data_posS$scenario == 17 | data_posS$scenario == 18 |data_posS$scenario == 19 |data_posS$scenario == 20,]
ggplot(data_posSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'darkred',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_posSb <- data_posS[data_posS$scenario == 21 | data_posS$scenario == 22 |data_posS$scenario == 23 |data_posS$scenario == 24,]
ggplot(data_posSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'darkred',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```

```{r,echo=FALSE,include=FALSE}

results_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$mse[1:24],4), rep = round(rep_norm_5e_8_10sim$mse[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$mse[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$mse[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$mse[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$mse[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$mse[(1+6*24):(24+6*24)],4), MSE_min_sp = round(rep_norm_5e_8_10sim$mse[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$mse[(1+8*24):(24+8*24)],4))

results_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#FCF3CF") %>%
  column_spec(2,background="#FEF9E7") %>%
  column_spec(3,background="#FEF9E7") %>%
  column_spec(4,background="#FEF9E7") %>%
  column_spec(5,background="#FEF9E7",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")
```

```{r,echo=FALSE, fig.show="hold", include=FALSE,out.width="50%",fig.height=3.6}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'darkred',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_negSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'darkred',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'darkred',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'darkred',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'darkred',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'darkred',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```

Summary of results for `rel_mse` contained in `replicate_norm_5e-8_10sim.csv`:

```{r,echo=FALSE}

results_rel_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$rel_mse[1:24],4), rep = round(rep_norm_5e_8_10sim$rel_mse[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$rel_mse[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$rel_mse[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$rel_mse[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$rel_mse[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$rel_mse[(1+6*24):(24+6*24)],4), MSE_min_sp = round(rep_norm_5e_8_10sim$rel_mse[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$rel_mse[(1+8*24):(24+8*24)],4))

results_rel_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D4EFDF") %>%
  column_spec(2,background="#E9F7EF") %>%
  column_spec(3,background="#E9F7EF") %>%
  column_spec(4,background="#E9F7EF") %>%
  column_spec(5,background="#E9F7EF",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")
```


$~$
$~$
$~$
$~$


The *mean* relative change in average MSE over all significant SNPs across the 24 scenarios is obtained for each method: 
```{r, echo=FALSE}
ranking <- results_rel_mse[,6:14]
summary2 <- apply(ranking,2,mean,na.rm=TRUE)
summary2
```


The methods are ranked according to the results above in ascending order:
```{r, echo=FALSE}
rank(summary2)
```



$~$
$~$
$~$
$~$



***Relative change*** **in average MSE over all significant SNPs due to method implementation with a replication and discovery GWAS of** ***equal*** **size, using a significance threshold of $5 \times 10^{-8}$:**

```{r,echo=FALSE, fig.show="hold", out.width="50%",fig.height=3.6, warning=FALSE}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_negSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 
```

$~$
$~$
$~$
$~$

We also look at how the methods compare when the replication data set is *50%* that of the discovery data set. 

```{r,echo=FALSE,include=FALSE}

rep_norm_5e_8_10sim <- read.csv("results/replicate_norm_5e-8_10sim_halfrep.csv")
results_flb <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$flb[1:24],4), rep = round(rep_norm_5e_8_10sim$flb[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$flb[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$flb[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$flb[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$flb[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$flb[(1+6*24):(24+6*24)],4), MSE_min_sp = round(rep_norm_5e_8_10sim$flb[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$flb[(1+8*24):(24+8*24)],4))


results_flb %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D4E6F1") %>%
  column_spec(2,background="#EAF2F8") %>%
  column_spec(3,background="#EAF2F8") %>%
  column_spec(4,background="#EAF2F8") %>%
  column_spec(5,background="#EAF2F8",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")

```


```{r,echo=FALSE, fig.show="hold", include=FALSE, out.width="50%",fig.height=3.6}

## plot results
rep_norm_5e_8_10sim$scenario <- c(rep(c(1:24),9))
rep_norm_5e_8_10sim$scenario <- factor(rep_norm_5e_8_10sim$scenario)

par(mar = c(4, 4, .1, .1))


data_negS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==-1),]
data_negSa <- data_negS[data_negS$scenario == 1 | data_negS$scenario == 2 |data_negS$scenario == 3 |data_negS$scenario == 4,]
ggplot(data_negSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_negSb <- data_negS[data_negS$scenario == 5 | data_negS$scenario == 6 |data_negS$scenario == 7 |data_negS$scenario == 8,]
ggplot(data_negSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==0),]
data_neutralSa <- data_neutralS[data_neutralS$scenario == 9 | data_neutralS$scenario == 10 |data_neutralS$scenario == 11 |data_neutralS$scenario == 12,]
ggplot(data_neutralSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralSb <- data_neutralS[data_neutralS$scenario == 13 | data_neutralS$scenario == 14 |data_neutralS$scenario == 15 |data_neutralS$scenario == 16,]
ggplot(data_neutralSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

data_posS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==1),]
data_posSa <- data_posS[data_posS$scenario == 17 | data_posS$scenario == 18 |data_posS$scenario == 19 |data_posS$scenario == 20,]
ggplot(data_posSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_posSb <- data_posS[data_posS$scenario == 21 | data_posS$scenario == 22 |data_posS$scenario == 23 |data_posS$scenario == 24,]
ggplot(data_posSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```


```{r,echo=FALSE,include=FALSE}

results_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$mse[1:24],4), rep = round(rep_norm_5e_8_10sim$mse[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$mse[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$mse[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$mse[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$mse[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$mse[(1+6*24):(24+6*24)],4), MSE_min_sp = round(rep_norm_5e_8_10sim$mse[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$mse[(1+8*24):(24+8*24)],4))

results_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#FCF3CF") %>%
  column_spec(2,background="#FEF9E7") %>%
  column_spec(3,background="#FEF9E7") %>%
  column_spec(4,background="#FEF9E7") %>%
  column_spec(5,background="#FEF9E7",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")
```



```{r,echo=FALSE, fig.show="hold", include=FALSE,out.width="50%",fig.height=3.6}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_negSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```



Summary of results for `rel_mse` contained in `replicate_norm_5e-8_10sim_halfrep.csv`:

```{r,echo=FALSE}

results_rel_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$rel_mse[1:24],4), rep = round(rep_norm_5e_8_10sim$rel_mse[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$rel_mse[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$rel_mse[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$rel_mse[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$rel_mse[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$rel_mse[(1+6*24):(24+6*24)],4), MSE_min_sp = round(rep_norm_5e_8_10sim$rel_mse[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$rel_mse[(1+8*24):(24+8*24)],4))

results_rel_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D4EFDF") %>%
  column_spec(2,background="#E9F7EF") %>%
  column_spec(3,background="#E9F7EF") %>%
  column_spec(4,background="#E9F7EF") %>%
  column_spec(5,background="#E9F7EF",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")
```


$~$
$~$
$~$
$~$


The *mean* relative change in average MSE over all significant SNPs across the 24 scenarios is obtained for each method: 
```{r, echo=FALSE}
ranking <- results_rel_mse[,6:14]
summary2 <- apply(ranking,2,mean,na.rm=TRUE)
summary2
```


The methods are ranked according to the results above in ascending order:
```{r, echo=FALSE}
rank(summary2)
```



$~$
$~$
$~$
$~$



***Relative change*** **in average MSE over all significant SNPs due to method implementation with a replication GWAS** ***50%*** **of the size of the discovery GWAS, using a significance threshold of $5 \times 10^{-8}$:**

```{r,echo=FALSE, fig.show="hold", out.width="50%",fig.height=3.6, warning=FALSE}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_negSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 
```

It is very interesting here how the empirical Bayes method behaves better in nearly all of the scenarios compared to UMVCUE, the replication method and the original MSE minimization method. 

$~$
$~$
$~$
$~$

Next, we look at how the methods compare when the replication data set is *10%* that of the discovery data set. 

```{r,echo=FALSE,include=FALSE}

rep_norm_5e_8_10sim <- read.csv("results/replicate_norm_5e-8_10sim_10pc.csv")
results_flb <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$flb[1:24],4), rep = round(rep_norm_5e_8_10sim$flb[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$flb[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$flb[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$flb[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$flb[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$flb[(1+6*24):(24+6*24)],4), MSE_min_sp = round(rep_norm_5e_8_10sim$flb[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$flb[(1+8*24):(24+8*24)],4))


results_flb %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D4E6F1") %>%
  column_spec(2,background="#EAF2F8") %>%
  column_spec(3,background="#EAF2F8") %>%
  column_spec(4,background="#EAF2F8") %>%
  column_spec(5,background="#EAF2F8",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")

```

```{r,echo=FALSE, fig.show="hold", include=FALSE, out.width="50%",fig.height=3.6}

## plot results
rep_norm_5e_8_10sim$scenario <- c(rep(c(1:24),9))
rep_norm_5e_8_10sim$scenario <- factor(rep_norm_5e_8_10sim$scenario)

par(mar = c(4, 4, .1, .1))


data_negS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==-1),]
data_negSa <- data_negS[data_negS$scenario == 1 | data_negS$scenario == 2 |data_negS$scenario == 3 |data_negS$scenario == 4,]
ggplot(data_negSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_negSb <- data_negS[data_negS$scenario == 5 | data_negS$scenario == 6 |data_negS$scenario == 7 |data_negS$scenario == 8,]
ggplot(data_negSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==0),]
data_neutralSa <- data_neutralS[data_neutralS$scenario == 9 | data_neutralS$scenario == 10 |data_neutralS$scenario == 11 |data_neutralS$scenario == 12,]
ggplot(data_neutralSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralSb <- data_neutralS[data_neutralS$scenario == 13 | data_neutralS$scenario == 14 |data_neutralS$scenario == 15 |data_neutralS$scenario == 16,]
ggplot(data_neutralSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

data_posS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==1),]
data_posSa <- data_posS[data_posS$scenario == 17 | data_posS$scenario == 18 |data_posS$scenario == 19 |data_posS$scenario == 20,]
ggplot(data_posSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_posSb <- data_posS[data_posS$scenario == 21 | data_posS$scenario == 22 |data_posS$scenario == 23 |data_posS$scenario == 24,]
ggplot(data_posSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```

```{r,echo=FALSE,include=FALSE}

results_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$mse[1:24],4), rep = round(rep_norm_5e_8_10sim$mse[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$mse[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$mse[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$mse[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$mse[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$mse[(1+6*24):(24+6*24)],4), MSE_min_sp = round(rep_norm_5e_8_10sim$mse[(1+7*24):(24+7*24)],4), EB_com =  round(rep_norm_5e_8_10sim$mse[(1+8*24):(24+8*24)],4))

results_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#FCF3CF") %>%
  column_spec(2,background="#FEF9E7") %>%
  column_spec(3,background="#FEF9E7") %>%
  column_spec(4,background="#FEF9E7") %>%
  column_spec(5,background="#FEF9E7",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")
```

```{r,echo=FALSE, fig.show="hold", include=FALSE,out.width="50%",fig.height=3.6}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_negSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") +scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```


Summary of results for `rel_mse` contained in `replicate_norm_5e-8_10sim_10pc.csv`:

```{r,echo=FALSE}

results_rel_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$rel_mse[1:24],4), rep = round(rep_norm_5e_8_10sim$rel_mse[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$rel_mse[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$rel_mse[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$rel_mse[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$rel_mse[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$rel_mse[(1+6*24):(24+6*24)],4),  MSE_min_sp = round(rep_norm_5e_8_10sim$rel_mse[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$rel_mse[(1+8*24):(24+8*24)],4))

results_rel_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D4EFDF") %>%
  column_spec(2,background="#E9F7EF") %>%
  column_spec(3,background="#E9F7EF") %>%
  column_spec(4,background="#E9F7EF") %>%
  column_spec(5,background="#E9F7EF",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")
```


$~$
$~$
$~$
$~$


The *mean* relative change in average MSE over all significant SNPs across the 24 scenarios is obtained for each method: 
```{r, echo=FALSE}
ranking <- results_rel_mse[,6:14]
summary2 <- apply(ranking,2,mean,na.rm=TRUE)
summary2
```


The methods are ranked according to the results above in ascending order:
```{r, echo=FALSE}
rank(summary2)
```



$~$
$~$
$~$
$~$



***Relative change*** **in average MSE over all significant SNPs due to method implementation with a replication GWAS** ***10%*** **of the size of the discovery GWAS, using a significance threshold of $5 \times 10^{-8}$:**

```{r,echo=FALSE, fig.show="hold", out.width="50%",fig.height=3.6, warning=FALSE}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_negSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 
```

In this situation, the empirical Bayes method tends to behave better than all of the other methods.

$~$
$~$
$~$
$~$

Following this, we look at how the methods compare when the replication data set is *twice* that of the discovery data set. 

```{r,echo=FALSE,include=FALSE}

rep_norm_5e_8_10sim <- read.csv("results/replicate_norm_5e-8_10sim_2.csv")
results_flb <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$flb[1:24],4), rep = round(rep_norm_5e_8_10sim$flb[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$flb[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$flb[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$flb[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$flb[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$flb[(1+6*24):(24+6*24)],4), MSE_min_sp = round(rep_norm_5e_8_10sim$flb[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$flb[(1+8*24):(24+8*24)],4))


results_flb %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D4E6F1") %>%
  column_spec(2,background="#EAF2F8") %>%
  column_spec(3,background="#EAF2F8") %>%
  column_spec(4,background="#EAF2F8") %>%
  column_spec(5,background="#EAF2F8",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")

```

```{r,echo=FALSE, fig.show="hold", include=FALSE, out.width="50%",fig.height=3.6}

## plot results
rep_norm_5e_8_10sim$scenario <- c(rep(c(1:24),9))
rep_norm_5e_8_10sim$scenario <- factor(rep_norm_5e_8_10sim$scenario)

par(mar = c(4, 4, .1, .1))


data_negS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==-1),]
data_negSa <- data_negS[data_negS$scenario == 1 | data_negS$scenario == 2 |data_negS$scenario == 3 |data_negS$scenario == 4,]
ggplot(data_negSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_negSb <- data_negS[data_negS$scenario == 5 | data_negS$scenario == 6 |data_negS$scenario == 7 |data_negS$scenario == 8,]
ggplot(data_negSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==0),]
data_neutralSa <- data_neutralS[data_neutralS$scenario == 9 | data_neutralS$scenario == 10 |data_neutralS$scenario == 11 |data_neutralS$scenario == 12,]
ggplot(data_neutralSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralSb <- data_neutralS[data_neutralS$scenario == 13 | data_neutralS$scenario == 14 |data_neutralS$scenario == 15 |data_neutralS$scenario == 16,]
ggplot(data_neutralSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

data_posS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==1),]
data_posSa <- data_posS[data_posS$scenario == 17 | data_posS$scenario == 18 |data_posS$scenario == 19 |data_posS$scenario == 20,]
ggplot(data_posSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_posSb <- data_posS[data_posS$scenario == 21 | data_posS$scenario == 22 |data_posS$scenario == 23 |data_posS$scenario == 24,]
ggplot(data_posSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```

```{r,echo=FALSE,include=FALSE}

results_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$mse[1:24],4), rep = round(rep_norm_5e_8_10sim$mse[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$mse[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$mse[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$mse[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$mse[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$mse[(1+6*24):(24+6*24)],4), MSE_min_sp = round(rep_norm_5e_8_10sim$mse[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$mse[(1+8*24):(24+8*24)],4))

results_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#FCF3CF") %>%
  column_spec(2,background="#FEF9E7") %>%
  column_spec(3,background="#FEF9E7") %>%
  column_spec(4,background="#FEF9E7") %>%
  column_spec(5,background="#FEF9E7",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")
```

```{r,echo=FALSE, fig.show="hold", include=FALSE,out.width="50%",fig.height=3.6}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_negSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```


Summary of results for `rel_mse` contained in `replicate_norm_5e-8_10sim_2.csv`:

```{r,echo=FALSE}

results_rel_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$rel_mse[1:24],4), rep = round(rep_norm_5e_8_10sim$rel_mse[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$rel_mse[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$rel_mse[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$rel_mse[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$rel_mse[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$rel_mse[(1+6*24):(24+6*24)],4),  MSE_min_sp = round(rep_norm_5e_8_10sim$rel_mse[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$rel_mse[(1+8*24):(24+8*24)],4))

results_rel_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D4EFDF") %>%
  column_spec(2,background="#E9F7EF") %>%
  column_spec(3,background="#E9F7EF") %>%
  column_spec(4,background="#E9F7EF") %>%
  column_spec(5,background="#E9F7EF",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")
```


$~$
$~$
$~$
$~$


The *mean* relative change in average MSE over all significant SNPs across the 24 scenarios is obtained for each method: 
```{r, echo=FALSE}
ranking <- results_rel_mse[,6:14]
summary2 <- apply(ranking,2,mean,na.rm=TRUE)
summary2
```


The methods are ranked according to the results above in ascending order:
```{r, echo=FALSE}
rank(summary2)
```



$~$
$~$
$~$
$~$



***Relative change*** **in average MSE over all significant SNPs due to method implementation with a replication GWAS** ***twice*** **the size of the discovery GWAS, using a significance threshold of $5 \times 10^{-8}$:**

```{r,echo=FALSE, fig.show="hold", out.width="50%",fig.height=3.6, warning=FALSE}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_negSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 
```



$~$
$~$
$~$
$~$

As a final step in this section, we investigate the behaviour of methods when the replication and discovery GWASs are of *equal size* and the effect sizes follow the previously described *bimodal* distribution.

```{r,echo=FALSE,include=FALSE}

rep_norm_5e_8_10sim <- read.csv("results/replicate_bim_5e-8_10sim.csv")
results_flb <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$flb[1:24],4), rep = round(rep_norm_5e_8_10sim$flb[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$flb[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$flb[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$flb[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$flb[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$flb[(1+6*24):(24+6*24)],4), MSE_min_sp = round(rep_norm_5e_8_10sim$flb[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$flb[(1+8*24):(24+8*24)],4))


results_flb %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D4E6F1") %>%
  column_spec(2,background="#EAF2F8") %>%
  column_spec(3,background="#EAF2F8") %>%
  column_spec(4,background="#EAF2F8") %>%
  column_spec(5,background="#EAF2F8",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")

```

```{r,echo=FALSE, fig.show="hold", include=FALSE, out.width="50%",fig.height=3.6}

## plot results
rep_norm_5e_8_10sim$scenario <- c(rep(c(1:24),9))
rep_norm_5e_8_10sim$scenario <- factor(rep_norm_5e_8_10sim$scenario)

par(mar = c(4, 4, .1, .1))


data_negS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==-1),]
data_negSa <- data_negS[data_negS$scenario == 1 | data_negS$scenario == 2 |data_negS$scenario == 3 |data_negS$scenario == 4,]
ggplot(data_negSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_negSb <- data_negS[data_negS$scenario == 5 | data_negS$scenario == 6 |data_negS$scenario == 7 |data_negS$scenario == 8,]
ggplot(data_negSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==0),]
data_neutralSa <- data_neutralS[data_neutralS$scenario == 9 | data_neutralS$scenario == 10 |data_neutralS$scenario == 11 |data_neutralS$scenario == 12,]
ggplot(data_neutralSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralSb <- data_neutralS[data_neutralS$scenario == 13 | data_neutralS$scenario == 14 |data_neutralS$scenario == 15 |data_neutralS$scenario == 16,]
ggplot(data_neutralSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") +scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

data_posS <- rep_norm_5e_8_10sim[which(rep_norm_5e_8_10sim$S==1),]
data_posSa <- data_posS[data_posS$scenario == 17 | data_posS$scenario == 18 |data_posS$scenario == 19 |data_posS$scenario == 20,]
ggplot(data_posSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_posSb <- data_posS[data_posS$scenario == 21 | data_posS$scenario == 22 |data_posS$scenario == 23 |data_posS$scenario == 24,]
ggplot(data_posSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#154360'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```

```{r,echo=FALSE,include=FALSE}

results_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$mse[1:24],4), rep = round(rep_norm_5e_8_10sim$mse[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$mse[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$mse[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$mse[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$mse[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$mse[(1+6*24):(24+6*24)],4), MSE_min_sp = round(rep_norm_5e_8_10sim$mse[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$mse[(1+8*24):(24+8*24)],4))

results_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#FCF3CF") %>%
  column_spec(2,background="#FEF9E7") %>%
  column_spec(3,background="#FEF9E7") %>%
  column_spec(4,background="#FEF9E7") %>%
  column_spec(5,background="#FEF9E7",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")
```

```{r,echo=FALSE, fig.show="hold", include=FALSE,out.width="50%",fig.height=3.6}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_negSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#7D6608'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```

Summary of results for `rel_mse` contained in `replicate_bim_5e-8_10sim.csv`:

```{r,echo=FALSE}

results_rel_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = rep_norm_5e_8_10sim$h2[1:24], prop_effect = rep_norm_5e_8_10sim$prop_effect[1:24], S= rep_norm_5e_8_10sim$S[1:24], EB = round(rep_norm_5e_8_10sim$rel_mse[1:24],4), rep = round(rep_norm_5e_8_10sim$rel_mse[(1+1*24):(24+1*24)],4), UMVCUE = round(rep_norm_5e_8_10sim$rel_mse[(1+2*24):(24+2*24)],4), cl1_com = round(rep_norm_5e_8_10sim$rel_mse[(1+3*24):(24+3*24)],4), cl2_MLE = round(rep_norm_5e_8_10sim$rel_mse[(1+4*24):(24+4*24)],4), cl3_MSE = round(rep_norm_5e_8_10sim$rel_mse[(1+5*24):(24+5*24)],4), MSE_min = round(rep_norm_5e_8_10sim$rel_mse[(1+6*24):(24+6*24)],4), MSE_min_sp = round(rep_norm_5e_8_10sim$rel_mse[(1+7*24):(24+7*24)],4), EB_com = round(rep_norm_5e_8_10sim$rel_mse[(1+8*24):(24+8*24)],4))

results_rel_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D4EFDF") %>%
  column_spec(2,background="#E9F7EF") %>%
  column_spec(3,background="#E9F7EF") %>%
  column_spec(4,background="#E9F7EF") %>%
  column_spec(5,background="#E9F7EF",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "100%", height = "300px")
```


$~$
$~$
$~$
$~$


The *mean* relative change in average MSE over all significant SNPs across the 24 scenarios is obtained for each method: 
```{r, echo=FALSE}
ranking <- results_rel_mse[,6:14]
summary2 <- apply(ranking,2,mean,na.rm=TRUE)
summary2
```


The methods are ranked according to the results above in ascending order:
```{r, echo=FALSE}
rank(summary2)
```



$~$
$~$
$~$
$~$



***Relative change*** **in average MSE over all significant SNPs due to method implementation with a replication and discovery GWAS of** ***equal*** **size, using a significance threshold of $5 \times 10^{-8}$ and a** ***bimodal*** **distribution of effect sizes:**

```{r,echo=FALSE, fig.show="hold", out.width="50%",fig.height=3.6, warning=FALSE}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7]))  +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_negSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,20,15,17,16,7)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],'red3',col[5],col[6],col[3],col[7])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 
```

$~$
$~$
$~$
$~$

### 7. Winner's Curse and Binary Traits

Under the same 24 scenarios, we investigate simulating summary statistics for a binary trait with disease prevalence of 0.1 and the corresponding performance of the various Winner's Curse adjustment methods. Below is a summary of the results contained in `binary_norm_nsig_prop_bias_5e-8_10sim.csv` and `binary_norm_nsig_prop_bias_5e-4_10sim.csv`. Compared to the quantitative trait above, we witness a lot less SNPs meeting the significance threshold of `5e-8` under many of the scenarios. 


```{r, echo=FALSE}
results_nsig_5e_8 <- read.csv("results/binary_norm_nsig_prop_bias_5e-8_10sim.csv")
results_nsig_5e_4 <- read.csv("results/binary_norm_nsig_prop_bias_5e-4_10sim.csv")
results_nsig <- data.frame(Scenario=c(1:24),n_samples=c(rep(c("30,000","300,000"),12)),results_nsig_5e_8[3:5], nsig_5e_8=round(results_nsig_5e_8$n_sig,2), pb58 = round(results_nsig_5e_8$prop_bias,4), px58 = round(results_nsig_5e_8$prop_x,4), mse58 = round(results_nsig_5e_8$mse,6), nsig_5e_4=round(results_nsig_5e_4$n_sig,2), pb54 = round(results_nsig_5e_4$prop_bias,4), px54 = round(results_nsig_5e_4$prop_x,4), mse54 = round(results_nsig_5e_4$mse,6), nsig_5e_8_sd=round(results_nsig_5e_8$n_sig_sd,3), pb58sd=round(results_nsig_5e_8$prop_bias_sd,4), px58sd=round(results_nsig_5e_8$prop_x_sd,4), mse58sd=round(results_nsig_5e_8$mse_sd,6),  nsig_5e_4_sd=round(results_nsig_5e_4$n_sig_sd,3),  pb54sd=round(results_nsig_5e_4$prop_bias_sd,4), px54sd=round(results_nsig_5e_4$prop_x_sd,4), mse54sd=round(results_nsig_5e_4$mse_sd,6))

names(results_nsig)[names(results_nsig) == "nsig_5e_8"] <- "n_sig 5e-8"
names(results_nsig)[names(results_nsig) == "nsig_5e_8_sd"] <- "sd(n_sig) 5e-8"
names(results_nsig)[names(results_nsig) == "pb58"] <- "prop_bias 5e-8"
names(results_nsig)[names(results_nsig) == "pb58sd"] <- "sd(prop_bias) 5e-8"
names(results_nsig)[names(results_nsig) == "px58"] <- "prop_x 5e-8"
names(results_nsig)[names(results_nsig) == "px58sd"] <- "sd(prop_x) 5e-8"
names(results_nsig)[names(results_nsig) == "nsig_5e_4"] <- "n_sig 5e-4"
names(results_nsig)[names(results_nsig) == "nsig_5e_4_sd"] <- "sd(n_sig) 5e-4"
names(results_nsig)[names(results_nsig) == "pb54"] <- "prop_bias 5e-4"
names(results_nsig)[names(results_nsig) == "pb54sd"] <- "sd(prop_bias) 5e-4"
names(results_nsig)[names(results_nsig) == "px54"] <- "prop_x 5e-4"
names(results_nsig)[names(results_nsig) == "px54sd"] <- "sd(prop_x) 5e-4"
names(results_nsig)[names(results_nsig) == "mse58"] <- "mse 5e-8"
names(results_nsig)[names(results_nsig) == "mse58sd"] <- "sd(mse) 5e-8"
names(results_nsig)[names(results_nsig) == "mse54"] <- "mse 5e-4"
names(results_nsig)[names(results_nsig) == "mse54sd"] <- "sd(mse) 5e-4"

results_nsig %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#FAE5D3") %>%
  column_spec(2,background="#FDF2E9") %>%
  column_spec(3,background="#FDF2E9") %>%
  column_spec(4,background="#FDF2E9") %>%
  column_spec(5,background="#FDF2E9", extra_css="border-right: 1px solid") %>% 
  column_spec(9, extra_css="border-right: 1px solid") %>%
  column_spec(13, extra_css="border-right: 1px solid") %>%
   column_spec(14, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(15, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(17, background = "#F5F5F5", italic=TRUE, extra_css="border-right: 1px solid") %>%
  column_spec(18, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(16, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(19, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(20, background = "#F5F5F5", italic=TRUE) %>%
  column_spec(21, background = "#F5F5F5", italic=TRUE) %>%
  scroll_box(width = "100%", height = "300px")

```

$~$
$~$
$~$
$~$


We plot $z$ vs $\text{bias}$ for the 24 different scenarios with a simulated binary trait. Similar to above, the points corresponding to SNPs which are *significantly* biased and are significant at a threshold of $5 \times 10^{-4}$ are coloured in <span style="color: navy;"> navy </span>. 

```{r, warning=FALSE,echo=FALSE,fig.show="hold", out.width="50%"}
set.seed(1998)

par(mar = c(4, 4, .1, .1))


## Scenario 1
ss <- simulate_ss_bin(H=0.3,Pi=0.01,nid=30000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + xlim(-6, 6) + geom_point(size=1) + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 1", subtitle="n_samples=30,000   h2=0.3   prop_effect=0.01   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[1]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )




## Scenario 2
ss <- simulate_ss_bin(H=0.3,Pi=0.01,nid=300000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) +  xlab("z") +
  ylab("bias") + ggtitle("Scenario 2", subtitle="n_samples=300,000   h2=0.3   prop_effect=0.01   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[2]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )




## Scenario 3
ss <- simulate_ss_bin(H=0.8,Pi=0.01,nid=30000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 3", subtitle="n_samples=30,000   h2=0.8   prop_effect=0.01   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[3]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )




## Scenario 4
ss <- simulate_ss_bin(H=0.8,Pi=0.01,nid=300000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 4", subtitle="n_samples=300,000   h2=0.8   prop_effect=0.01   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[4]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 5
ss <- simulate_ss_bin(H=0.3,Pi=0.001,nid=30000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 5", subtitle="n_samples=30,000   h2=0.3   prop_effect=0.001   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[5]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 6
ss <- simulate_ss_bin(H=0.3,Pi=0.001,nid=300000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 6", subtitle="n_samples=300,000   h2=0.3   prop_effect=0.001   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[6]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 7
ss <- simulate_ss_bin(H=0.8,Pi=0.001,nid=30000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 7", subtitle="n_samples=30,000   h2=0.8   prop_effect=0.001   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[7]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 8
ss <- simulate_ss_bin(H=0.8,Pi=0.001,nid=300000,sc=-1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 8", subtitle="n_samples=300,000   h2=0.8   prop_effect=0.001   S=-1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[8]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 9
ss <- simulate_ss_bin(H=0.3,Pi=0.01,nid=30000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + xlim(-6, 6) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 9", subtitle="n_samples=30,000   h2=0.3   prop_effect=0.01   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[1]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 10
ss <- simulate_ss_bin(H=0.3,Pi=0.01,nid=300000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 10", subtitle="n_samples=300,000   h2=0.3   prop_effect=0.01   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[2]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 11
ss <- simulate_ss_bin(H=0.8,Pi=0.01,nid=30000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 11", subtitle="n_samples=30,000   h2=0.8   prop_effect=0.01   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[3]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 12
ss <- simulate_ss_bin(H=0.8,Pi=0.01,nid=300000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 12", subtitle="n_samples=300,000   h2=0.8   prop_effect=0.01   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[4]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 13
ss <- simulate_ss_bin(H=0.3,Pi=0.001,nid=30000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 13", subtitle="n_samples=30,000   h2=0.3   prop_effect=0.001   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[5]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 14
ss <- simulate_ss_bin(H=0.3,Pi=0.001,nid=300000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 14", subtitle="n_samples=300,000   h2=0.3   prop_effect=0.001   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[6]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 15
ss <- simulate_ss_bin(H=0.8,Pi=0.001,nid=30000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 15", subtitle="n_samples=30,000   h2=0.8   prop_effect=0.001   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[7]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 16
ss <- simulate_ss_bin(H=0.8,Pi=0.001,nid=300000,sc=0)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 16", subtitle="n_samples=300,000   h2=0.8   prop_effect=0.001   S=0") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[8]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 17
ss <- simulate_ss_bin(H=0.3,Pi=0.01,nid=30000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + xlim(-6, 6) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 17", subtitle="n_samples=30,000   h2=0.3   prop_effect=0.01   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[1]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 18
ss <- simulate_ss_bin(H=0.3,Pi=0.01,nid=300000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 18", subtitle="n_samples=300,000   h2=0.3   prop_effect=0.01   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[2]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 19
ss <- simulate_ss_bin(H=0.8,Pi=0.01,nid=30000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 19", subtitle="n_samples=30,000   h2=0.8   prop_effect=0.01   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[3]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 20
ss <- simulate_ss_bin(H=0.8,Pi=0.01,nid=300000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 20", subtitle="n_samples=300,000   h2=0.8   prop_effect=0.01   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
  geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[4]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 21
ss <- simulate_ss_bin(H=0.3,Pi=0.001,nid=30000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 21", subtitle="n_samples=30,000   h2=0.3   prop_effect=0.001   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[5]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 22
ss <- simulate_ss_bin(H=0.3,Pi=0.001,nid=300000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 22", subtitle="n_samples=300,000   h2=0.3   prop_effect=0.001   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[6]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )


## Scenario 23
ss <- simulate_ss_bin(H=0.8,Pi=0.001,nid=30000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 23", subtitle="n_samples=30,000   h2=0.8   prop_effect=0.001   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[7]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )

## Scenario 24
ss <- simulate_ss_bin(H=0.8,Pi=0.001,nid=300000,sc=1)
out <- simulate_est(ss)
out$z <- out$beta/out$se
out$bias <- out$beta - ss$true_beta
subout <- out[(abs(out$beta) > (abs(ss$true_beta) + 1.96*ss$se)) & (abs(out$beta/out$se) > qnorm(1-(5e-4)/2)),]
ggplot(out,aes(x=z,y=bias)) + geom_point(size=1)  + geom_point(data=subout, 
             aes(x=z,y=bias), 
             color='navy',
             size=1) + xlab("z") +
  ylab("bias") + ggtitle("Scenario 24", subtitle="n_samples=300,000   h2=0.8   prop_effect=0.001   S=1") +  theme_classic() + geom_vline(xintercept=qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-8)/2), colour="red", linetype="dashed",size=1) +
geom_vline(xintercept=qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) + geom_vline(xintercept=-qnorm(1-(5e-4)/2), colour="darkred", linetype="dashed",size=1) +
  geom_hline(yintercept=0) +
  theme(
    plot.title = element_text(hjust = 0.5, face="bold", colour=col[8]),
    plot.subtitle = element_text(hjust = 0.5, face="italic")
  )
```

$~$
$~$
$~$
$~$



```{r,echo=FALSE,include=FALSE}

norm_5e_4_10sim <- read.csv("results/binary_norm_5e-8_10sim.csv")
results_flb <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = norm_5e_4_10sim$h2[1:24], prop_effect = norm_5e_4_10sim$prop_effect[1:24], S= norm_5e_4_10sim$S[1:24], EB = round(norm_5e_4_10sim$flb[1:24],4), FIQT = round(norm_5e_4_10sim$flb[(1+24):(24+24)],4), BR = round(norm_5e_4_10sim$flb[(1+2*24):(24+2*24)],4), cl1 = round(norm_5e_4_10sim$flb[(1+3*24):(24+3*24)],4), cl2 = round(norm_5e_4_10sim$flb[(1+4*24):(24+4*24)],4), cl3 = round(norm_5e_4_10sim$flb[(1+5*24):(24+5*24)],4), rep = round(norm_5e_4_10sim$flb[(1+6*24):(24+6*24)],4))

results_flb %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#F2D7D5") %>%
  column_spec(2,background="#F9EBEA") %>%
  column_spec(3,background="#F9EBEA") %>%
  column_spec(4,background="#F9EBEA") %>%
  column_spec(5,background="#F9EBEA",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "90%", height = "300px")

```


```{r,echo=FALSE,include=FALSE, fig.show="hold",out.width="50%",fig.height=3.6}

## plot results
norm_5e_4_10sim$scenario <- c(rep(c(1:24),7))
norm_5e_4_10sim$scenario <- factor(norm_5e_4_10sim$scenario)

par(mar = c(4, 4, .1, .1))


data_negS <- norm_5e_4_10sim[which(norm_5e_4_10sim$S==-1),]
data_negSa <- data_negS[data_negS$scenario == 1 | data_negS$scenario == 2 |data_negS$scenario == 3 |data_negS$scenario == 4,]
ggplot(data_negSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_negSb <- data_negS[data_negS$scenario == 5 | data_negS$scenario == 6 |data_negS$scenario == 7 |data_negS$scenario == 8,]
ggplot(data_negSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralS <- norm_5e_4_10sim[which(norm_5e_4_10sim$S==0),]
data_neutralSa <- data_neutralS[data_neutralS$scenario == 9 | data_neutralS$scenario == 10 |data_neutralS$scenario == 11 |data_neutralS$scenario == 12,]
ggplot(data_neutralSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralSb <- data_neutralS[data_neutralS$scenario == 13 | data_neutralS$scenario == 14 |data_neutralS$scenario == 15 |data_neutralS$scenario == 16,]
ggplot(data_neutralSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
 ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

data_posS <- norm_5e_4_10sim[which(norm_5e_4_10sim$S==1),]
data_posSa <- data_posS[data_posS$scenario == 17 | data_posS$scenario == 18 |data_posS$scenario == 19 |data_posS$scenario == 20,]
ggplot(data_posSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_posSb <- data_posS[data_posS$scenario == 21 | data_posS$scenario == 22 |data_posS$scenario == 23 |data_posS$scenario == 24,]
ggplot(data_posSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
 ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```



```{r,echo=FALSE,include=FALSE}

results_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = norm_5e_4_10sim$h2[1:24], prop_effect = norm_5e_4_10sim$prop_effect[1:24], S= norm_5e_4_10sim$S[1:24], EB = round(norm_5e_4_10sim$mse[1:24],6), FIQT = round(norm_5e_4_10sim$mse[(1+24):(24+24)],6), BR = round(norm_5e_4_10sim$mse[(1+2*24):(24+2*24)],6), cl1 = round(norm_5e_4_10sim$mse[(1+3*24):(24+3*24)],6), cl2 = round(norm_5e_4_10sim$mse[(1+4*24):(24+4*24)],6), cl3 = round(norm_5e_4_10sim$mse[(1+5*24):(24+5*24)],6), rep = round(norm_5e_4_10sim$mse[(1+6*24):(24+6*24)],6))

results_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#E8DAEF") %>%
  column_spec(2,background="#F4ECF7") %>%
  column_spec(3,background="#F4ECF7") %>%
  column_spec(4,background="#F4ECF7") %>%
  column_spec(5,background="#F4ECF7",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "95%", height = "300px")
```



```{r,echo=FALSE, include=FALSE,fig.show="hold", out.width="50%",fig.height=3.6}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_negSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_neutralSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_posSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```


$~$
$~$
$~$
$~$



Summary of results for `rel_mse` contained in `binary_norm_5e-8_10sim.csv`: 

```{r,echo=FALSE}

results_rel_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = norm_5e_4_10sim$h2[1:24], prop_effect = norm_5e_4_10sim$prop_effect[1:24], S= norm_5e_4_10sim$S[1:24], EB = round(norm_5e_4_10sim$rel_mse[1:24],4), FIQT = round(norm_5e_4_10sim$rel_mse[(1+24):(24+24)],4), BR = round(norm_5e_4_10sim$rel_mse[(1+2*24):(24+2*24)],4), cl1 = round(norm_5e_4_10sim$rel_mse[(1+3*24):(24+3*24)],4), cl2 = round(norm_5e_4_10sim$rel_mse[(1+4*24):(24+4*24)],4), cl3 = round(norm_5e_4_10sim$rel_mse[(1+5*24):(24+5*24)],4), rep = round(norm_5e_4_10sim$rel_mse[(1+6*24):(24+6*24)],4))

results_rel_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D0ECE7") %>%
  column_spec(2,background="#E8F6F3") %>%
  column_spec(3,background="#E8F6F3") %>%
  column_spec(4,background="#E8F6F3") %>%
  column_spec(5,background="#E8F6F3",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "80%", height = "300px")
```
$~$
$~$
$~$
$~$


The *mean* relative change in average MSE over all significant SNPs across the 24 scenarios is obtained for each method: 
```{r, echo=FALSE}
ranking <- results_rel_mse[,6:12]
summary2 <- apply(ranking,2,mean,na.rm=TRUE)
summary2
```


The methods are ranked according to the results above in ascending order:
```{r, echo=FALSE}
rank(summary2)
```



$~$
$~$
$~$
$~$

***Relative change*** **in average MSE over all significant SNPs due to method implementation for a** ***binary*** **trait, using a significance threshold of $5 \times 10^{-8}$:**

```{r,echo=FALSE, fig.show="hold", warning=FALSE,out.width="50%",fig.height=3.6}



par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_negSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_posSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```

$~$
$~$
$~$
$~$

Note the absence of data for Scenario 13 in the above plot which is due to the fact that across all 10 simulations, no SNPs reached the significance threshold. Refer back to the first table in this section in order to gain an insight into the expected number of significant SNPs under each scenario.  

```{r,echo=FALSE,include=FALSE}

norm_5e_4_10sim <- read.csv("results/binary_norm_5e-4_10sim.csv")
results_flb <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = norm_5e_4_10sim$h2[1:24], prop_effect = norm_5e_4_10sim$prop_effect[1:24], S= norm_5e_4_10sim$S[1:24], EB = round(norm_5e_4_10sim$flb[1:24],4), FIQT = round(norm_5e_4_10sim$flb[(1+24):(24+24)],4), BR = round(norm_5e_4_10sim$flb[(1+2*24):(24+2*24)],4), cl1 = round(norm_5e_4_10sim$flb[(1+3*24):(24+3*24)],4), cl2 = round(norm_5e_4_10sim$flb[(1+4*24):(24+4*24)],4), cl3 = round(norm_5e_4_10sim$flb[(1+5*24):(24+5*24)],4), rep = round(norm_5e_4_10sim$flb[(1+6*24):(24+6*24)],4))

results_flb %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#F2D7D5") %>%
  column_spec(2,background="#F9EBEA") %>%
  column_spec(3,background="#F9EBEA") %>%
  column_spec(4,background="#F9EBEA") %>%
  column_spec(5,background="#F9EBEA",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "90%", height = "300px")

```


```{r,echo=FALSE,include=FALSE, fig.show="hold",out.width="50%",fig.height=3.6}

## plot results
norm_5e_4_10sim$scenario <- c(rep(c(1:24),7))
norm_5e_4_10sim$scenario <- factor(norm_5e_4_10sim$scenario)

par(mar = c(4, 4, .1, .1))


data_negS <- norm_5e_4_10sim[which(norm_5e_4_10sim$S==-1),]
data_negSa <- data_negS[data_negS$scenario == 1 | data_negS$scenario == 2 |data_negS$scenario == 3 |data_negS$scenario == 4,]
ggplot(data_negSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_negSb <- data_negS[data_negS$scenario == 5 | data_negS$scenario == 6 |data_negS$scenario == 7 |data_negS$scenario == 8,]
ggplot(data_negSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralS <- norm_5e_4_10sim[which(norm_5e_4_10sim$S==0),]
data_neutralSa <- data_neutralS[data_neutralS$scenario == 9 | data_neutralS$scenario == 10 |data_neutralS$scenario == 11 |data_neutralS$scenario == 12,]
ggplot(data_neutralSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_neutralSb <- data_neutralS[data_neutralS$scenario == 13 | data_neutralS$scenario == 14 |data_neutralS$scenario == 15 |data_neutralS$scenario == 16,]
ggplot(data_neutralSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
 ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

data_posS <- norm_5e_4_10sim[which(norm_5e_4_10sim$S==1),]
data_posSa <- data_posS[data_posS$scenario == 17 | data_posS$scenario == 18 |data_posS$scenario == 19 |data_posS$scenario == 20,]
ggplot(data_posSa,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


data_posSb <- data_posS[data_posS$scenario == 21 | data_posS$scenario == 22 |data_posS$scenario == 23 |data_posS$scenario == 24,]
ggplot(data_posSb,aes(x=scenario,y=flb,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
 ylab(expression(paste("Fraction of", italic(" improved "), "sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=flb-flb_error, ymax=flb+flb_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0.5, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#641E16'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```



```{r,echo=FALSE,include=FALSE}

results_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = norm_5e_4_10sim$h2[1:24], prop_effect = norm_5e_4_10sim$prop_effect[1:24], S= norm_5e_4_10sim$S[1:24], EB = round(norm_5e_4_10sim$mse[1:24],6), FIQT = round(norm_5e_4_10sim$mse[(1+24):(24+24)],6), BR = round(norm_5e_4_10sim$mse[(1+2*24):(24+2*24)],6), cl1 = round(norm_5e_4_10sim$mse[(1+3*24):(24+3*24)],6), cl2 = round(norm_5e_4_10sim$mse[(1+4*24):(24+4*24)],6), cl3 = round(norm_5e_4_10sim$mse[(1+5*24):(24+5*24)],6), rep = round(norm_5e_4_10sim$mse[(1+6*24):(24+6*24)],6))

results_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#E8DAEF") %>%
  column_spec(2,background="#F4ECF7") %>%
  column_spec(3,background="#F4ECF7") %>%
  column_spec(4,background="#F4ECF7") %>%
  column_spec(5,background="#F4ECF7",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "95%", height = "300px")
```



```{r,echo=FALSE, include=FALSE,fig.show="hold", out.width="50%",fig.height=3.6}

par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_negSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3],col[7])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_neutralSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_posSa,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSb,aes(x=scenario,y=mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste(italic("Change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=mse-mse_error, ymax=mse+mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#4A235A'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```

$~$
$~$
$~$
$~$

Summary of results for `rel_mse` contained in `binary_norm_5e-4_10sim.csv`: 

```{r,echo=FALSE}

results_rel_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = norm_5e_4_10sim$h2[1:24], prop_effect = norm_5e_4_10sim$prop_effect[1:24], S= norm_5e_4_10sim$S[1:24], EB = round(norm_5e_4_10sim$rel_mse[1:24],4), FIQT = round(norm_5e_4_10sim$rel_mse[(1+24):(24+24)],4), BR = round(norm_5e_4_10sim$rel_mse[(1+2*24):(24+2*24)],4), cl1 = round(norm_5e_4_10sim$rel_mse[(1+3*24):(24+3*24)],4), cl2 = round(norm_5e_4_10sim$rel_mse[(1+4*24):(24+4*24)],4), cl3 = round(norm_5e_4_10sim$rel_mse[(1+5*24):(24+5*24)],4), rep = round(norm_5e_4_10sim$rel_mse[(1+6*24):(24+6*24)],4))

results_rel_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D0ECE7") %>%
  column_spec(2,background="#E8F6F3") %>%
  column_spec(3,background="#E8F6F3") %>%
  column_spec(4,background="#E8F6F3") %>%
  column_spec(5,background="#E8F6F3",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "80%", height = "300px")
```
$~$
$~$
$~$
$~$


The *mean* relative change in average MSE over all significant SNPs across the 24 scenarios is obtained for each method: 
```{r, echo=FALSE}
ranking <- results_rel_mse[,6:12]
summary2 <- apply(ranking,2,mean,na.rm=TRUE)
summary2
```


The methods are ranked according to the results above in ascending order:
```{r, echo=FALSE}
rank(summary2)
```



$~$
$~$
$~$
$~$

***Relative change*** **in average MSE over all significant SNPs due to method implementation for a** ***binary*** **trait, using a significance threshold of $5 \times 10^{-4}$:**

```{r,echo=FALSE, fig.show="hold", warning=FALSE,out.width="50%",fig.height=3.6}



par(mar = c(4, 4, .1, .1))

ggplot(data_negSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3]))  +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_negSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_neutralSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))

ggplot(data_posSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))


ggplot(data_posSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(6,18,10,20,15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[8],col[4],col[5],col[6],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#0B5345'),plot.subtitle = element_text(hjust = 0.5, face="italic"))
```



### 8. Comparison of the Empirical Bayes method with the true Bayes rule



Summary of results for `rel_mse` contained in `norm_5e-8_10sim_bayes_compare.csv`:

```{r,echo=FALSE}

norm_5e_8_5sim_bayes <- read.csv("results/norm_5e-8_10sim_bayes_compare.csv")

results_rel_mse <- data.frame(Scenario=c(1:24),n_samples = c(rep(c("30,000","300,000"),12)), h2 = norm_5e_8_5sim_bayes$h2[1:24], prop_effect = norm_5e_8_5sim_bayes$prop_effect[1:24], S= norm_5e_8_5sim_bayes$S[1:24], EB = round(norm_5e_8_5sim_bayes$rel_mse[1:24],4), bayes = round(norm_5e_8_5sim_bayes$rel_mse[(1+24):(24+24)],4), rep = round(norm_5e_8_5sim_bayes$rel_mse[(1+2*24):(24+2*24)],4))

results_rel_mse %>%
kable() %>%
  kable_classic_2() %>%
kable_styling(bootstrap_options = "bordered",
full_width = FALSE,position="center") %>%
  row_spec(row = 0,bold = TRUE) %>%
  column_spec(1,background="#D4EFDF") %>%
  column_spec(2,background="#E9F7EF") %>%
  column_spec(3,background="#E9F7EF") %>%
  column_spec(4,background="#E9F7EF") %>%
  column_spec(5,background="#E9F7EF",extra_css="border-right: 1px solid") %>%
  scroll_box(width = "60%", height = "300px")
```



$~$
$~$
$~$
$~$


The *mean* relative change in average MSE over all significant SNPs across the 24 scenarios is obtained for each method: 
```{r, echo=FALSE}
ranking <- results_rel_mse[,6:8]
summary2 <- apply(ranking,2,mean,na.rm=TRUE)
summary2
```


The methods are ranked according to the results above in ascending order:
```{r, echo=FALSE}
rank(summary2)
```



$~$
$~$
$~$
$~$



***Relative change*** **in average MSE over all significant SNPs due to method implementation, using a significance threshold of $5 \times 10^{-8}$:**

```{r,echo=FALSE, fig.show="hold", out.width="50%",fig.height=3.6, warning=FALSE}

norm_5e_8_5sim_bayes$scenario <- c(rep(c(1:24),3))
norm_5e_8_5sim_bayes$scenario <- factor(norm_5e_8_5sim_bayes$scenario)

par(mar = c(4, 4, .1, .1))


data_negS <- norm_5e_8_5sim_bayes[which(norm_5e_8_5sim_bayes$S==-1),]
data_negSa <- data_negS[data_negS$scenario == 1 | data_negS$scenario == 2 |data_negS$scenario == 3 |data_negS$scenario == 4,]
data_negSb <- data_negS[data_negS$scenario == 5 | data_negS$scenario == 6 |data_negS$scenario == 7 |data_negS$scenario == 8,]

data_neutralS <- norm_5e_8_5sim_bayes[which(norm_5e_8_5sim_bayes$S==0),]
data_neutralSa <- data_neutralS[data_neutralS$scenario == 9 | data_neutralS$scenario == 10 |data_neutralS$scenario == 11 |data_neutralS$scenario == 12,]
data_neutralSb <- data_neutralS[data_neutralS$scenario == 13 | data_neutralS$scenario == 14 |data_neutralS$scenario == 15 |data_neutralS$scenario == 16,]

data_posS <- norm_5e_8_5sim_bayes[which(norm_5e_8_5sim_bayes$S==1),]
data_posSa <- data_posS[data_posS$scenario == 17 | data_posS$scenario == 18 |data_posS$scenario == 19 |data_posS$scenario == 20,]
data_posSb <- data_posS[data_posS$scenario == 21 | data_posS$scenario == 22 |data_posS$scenario == 23 |data_posS$scenario == 24,]


ggplot(data_negSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 1 - 4", subtitle="S=-1   prop_effect=0.01")  + scale_shape_manual(values=c(15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[3]))  +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + xlab("") + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10), plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_negSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 5 - 8", subtitle="S=-1   prop_effect=0.001") + scale_shape_manual(values=c(15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") + theme(axis.text.x = element_text(face ="bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + scale_shape_manual(values=c(15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[3])) + xlab("") + ggtitle("Scenarios 9 - 12", subtitle="S=0   prop_effect=0.01") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_neutralSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 13 - 16", subtitle="S=0   prop_effect=0.001") + scale_shape_manual(values=c(15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSa,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 17 - 20", subtitle="S=1   prop_effect=0.01") + scale_shape_manual(values=c(15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 

ggplot(data_posSb,aes(x=scenario,y=rel_mse,colour=method)) + geom_point(position=position_dodge(0.4),size=4.5,aes(shape=method, color=method)) + ggtitle("Scenarios 21 - 24", subtitle="S=1   prop_effect=0.001") + scale_shape_manual(values=c(15,17,16)) + scale_color_manual(values=c(col[1],col[2],col[3])) + xlab("") +
  ylab(expression(paste("Rel.", italic(" change "), "in MSE of sig. SNPs"))) + theme_classic() + geom_errorbar(aes(ymin=rel_mse-rel_mse_error, ymax=rel_mse+rel_mse_error), width=.25,position=position_dodge(0.4)) + geom_hline(yintercept=0, colour="black") +  theme(axis.text.x = element_text(face = "bold",size=rel(1.25)),legend.title = element_blank(),legend.box.background = element_rect(colour = "black"),legend.spacing.y = unit(0, "mm"), legend.background=element_blank(), legend.text = element_text(size=10),plot.title = element_text(hjust = 0.5, face="bold", colour='#145A32'),plot.subtitle = element_text(hjust = 0.5, face="italic")) 
```

$~$
$~$
$~$
$~$
